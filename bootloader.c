/*
 * bootloader.c
 *
 *  Created on: Sep 20, 2023
 *      Author: Ahned2XD
 */
#include "bootloader.h"





uint32_t myData=0;/*{0x20000200,  0x000204E7, 0x000204ED, 0x000204EF, 0x000204F1, 0x000204F1, 0x000204F1, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x000204F1, 0x000204F1, 0x00000000, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1,
                   0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1,
                   0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x00000000, 0x00000000, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1,
                   0x000204F1, 0x000204F1, 0x000204F1, 0x00000000, 0x00000000, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1,
                   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x000204F1, 0x000204F1, 0x000204F1,
                   0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x00000000, 0x00000000, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x00000000, 0x00000000, 0x000204F1, 0x000204F1,
                   0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x000204F1, 0x47F0E92D, 0x461F4684,
                   0xF8DF4856, 0xF8DF9154, 0x68038158, 0x0303EA09, 0xD01B4598, 0xF04F2400, 0xF04F0A01, 0xFA0A0E03, 0x4219F304, 0xF8DCD00F, 0x00663FC4, 0xF506FA0E, 0xF8CC43AB, 0xF8DC3FC4, 0xF3C25FC4, 0x40B31341, 0xF8CC432B, 0x1C643FC4, 0xDBE82C08, 0xBF270853, 0x3500F8DC, 0xF8DC430B, 0x438B3500,
                   0x3500F8CC, 0xBF270893, 0x3504F8DC, 0xF8DC430B, 0x438B3504, 0x3504F8CC, 0xBF2708D3, 0x3508F8DC, 0xF8DC430B, 0x438B3508, 0x3508F8CC, 0xBF270913, 0x3518F8DC, 0xF8DC430B, 0x438B3518, 0x3518F8CC, 0x464C6803, 0x40234645, 0xD009429D, 0xBF270952, 0x253CF8DC, 0xF8DC430A, 0x438A253C,
                   0x253CF8CC, 0xBF27087A, 0x250CF8DC, 0xF8DC430A, 0x438A250C, 0x250CF8CC, 0xBF2708BA, 0x2510F8DC, 0xF8DC430A, 0x438A2510, 0x2510F8CC, 0xBF2708FA, 0x2514F8DC, 0xF8DC430A, 0x438A2514, 0x2514F8CC, 0xBF27093A, 0x251CF8DC, 0xF8DC430A, 0x438A251C, 0x251CF8CC, 0x40046800, 0xD01442A5,
                   0xBF270AB8, 0x0544F8DC, 0xF8DC4308, 0x43880544, 0x7F40F417, 0x0544F8CC, 0xF8DCBF19, 0x43080540, 0x0540F8DC, 0xF8CC4388, 0x2F000540, 0xF8DCBF19, 0xEA200528, 0xF8DC0101, 0x43010528, 0x1528F8CC, 0x87F0E8BD, 0x70FF0000, 0x400FE000, 0x10050000, 0x4815B50E, 0xF830F000, 0x210E4814,
                   0xF872F000, 0x210E4812, 0xF0002200, 0x4811F880, 0xF8AD8800, 0x20000000, 0x0004F88D, 0x0004F89D, 0x71D0EB00, 0x0101F021, 0xF88D1A40, 0xF89D0004, 0xF8100004, 0x1C41200D, 0xF88D4805, 0x210E1004, 0xF865F000, 0xF0004804, 0xE7E7F865, 0xF0000805, 0x40025000, 0x00020506, 0x004C4B40,
                   0x08C14A0B, 0x2307F3C0, 0x51FFF401, 0x00FFF000, 0x3150F5A1, 0xF02118D2, 0x0F12417E, 0x7102EA41, 0xEA412201, 0xF0410180, 0x60027000, 0x46C04770, 0x400FE600, 0xBF270853, 0x3400F8D0, 0xF8D0430B, 0x438B3400, 0xF8C00892, 0xBF273400, 0x2420F8D0, 0xF8D04311, 0xEA222420, 0xF8C00101,
                   0x47701420, 0xF3804808, 0x49088808, 0xF4406808, 0x60080070, 0xBF00BF00, 0xF823F000, 0xF7FF2000, 0x2001FF8D, 0xF81FF000, 0x20000200, 0xE000ED88, 0x2201B538, 0x4605460C, 0xF7FF2308, 0x2201FEC9, 0x46284621, 0xFFC8F7FF, 0xF7FFBD38, 0x4770BFDB, 0xE7FEE7FE, 0xF840E7FE, 0x47702021,
                   0xD1FD1E40, 0x20014770, 0xBF004770, 0x0008E7FE};*/


const uint8_t dummy_image_0[] = { 0x00, 0x02, 0x00, 0x20, 0xe7, 0x04, 0x02, 0x00, 0xed, 0x04, 0x02, 0x00, 0xef, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04,
0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04,
0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0x2d, 0xe9, 0xf0, 0x47, 0x84, 0x46, 0x1f, 0x46, 0x56, 0x48, 0xdf, 0xf8, 0x54, 0x91, 0xdf, 0xf8, 0x58, 0x81, 0x03, 0x68, 0x09, 0xea, 0x03, 0x03, 0x98, 0x45, 0x1b, 0xd0, 0x00, 0x24, 0x4f, 0xf0, 0x01, 0x0a, 0x4f, 0xf0, 0x03, 0x0e, 0x0a, 0xfa, 0x04, 0xf3, 0x19, 0x42, 0x0f, 0xd0, 0xdc, 0xf8, 0xc4, 0x3f, 0x66, 0x00, 0x0e, 0xfa, 0x06, 0xf5, 0xab, 0x43, 0xcc, 0xf8, 0xc4, 0x3f, 0xdc, 0xf8, 0xc4, 0x5f, 0xc2, 0xf3, 0x41, 0x13, 0xb3, 0x40, 0x2b, 0x43, 0xcc, 0xf8, 0xc4, 0x3f, 0x64, 0x1c, 0x08, 0x2c, 0xe8, 0xdb, 0x53, 0x08, 0x27, 0xbf, 0xdc, 0xf8, 0x00, 0x35, 0x0b, 0x43, 0xdc, 0xf8, 0x00, 0x35, 0x8b, 0x43, 0xcc, 0xf8, 0x00, 0x35, 0x93, 0x08, 0x27, 0xbf, 0xdc, 0xf8,
0x04, 0x35, 0x0b, 0x43, 0xdc, 0xf8, 0x04, 0x35, 0x8b, 0x43, 0xcc, 0xf8, 0x04, 0x35, 0xd3, 0x08, 0x27, 0xbf, 0xdc, 0xf8, 0x08, 0x35, 0x0b, 0x43, 0xdc, 0xf8, 0x08, 0x35, 0x8b, 0x43, 0xcc, 0xf8, 0x08, 0x35, 0x13, 0x09, 0x27, 0xbf, 0xdc, 0xf8, 0x18, 0x35, 0x0b, 0x43, 0xdc, 0xf8, 0x18, 0x35, 0x8b, 0x43, 0xcc, 0xf8, 0x18, 0x35, 0x03, 0x68, 0x4c, 0x46, 0x45, 0x46, 0x23, 0x40, 0x9d, 0x42, 0x09, 0xd0, 0x52, 0x09, 0x27, 0xbf, 0xdc, 0xf8, 0x3c, 0x25, 0x0a, 0x43, 0xdc, 0xf8, 0x3c, 0x25, 0x8a, 0x43, 0xcc, 0xf8, 0x3c, 0x25, 0x7a, 0x08, 0x27, 0xbf, 0xdc, 0xf8, 0x0c, 0x25, 0x0a, 0x43, 0xdc, 0xf8, 0x0c, 0x25, 0x8a, 0x43, 0xcc, 0xf8, 0x0c, 0x25, 0xba, 0x08, 0x27, 0xbf, 0xdc, 0xf8, 0x10, 0x25, 0x0a, 0x43, 0xdc, 0xf8, 0x10, 0x25, 0x8a, 0x43, 0xcc, 0xf8, 0x10, 0x25, 0xfa, 0x08, 0x27, 0xbf, 0xdc, 0xf8, 0x14, 0x25, 0x0a, 0x43, 0xdc, 0xf8, 0x14, 0x25, 0x8a, 0x43, 0xcc, 0xf8, 0x14, 0x25, 0x3a, 0x09, 0x27, 0xbf, 0xdc, 0xf8, 0x1c, 0x25, 0x0a, 0x43, 0xdc, 0xf8, 0x1c, 0x25, 0x8a, 0x43, 0xcc, 0xf8, 0x1c, 0x25, 0x00, 0x68, 0x04, 0x40, 0xa5, 0x42, 0x14, 0xd0, 0xb8, 0x0a, 0x27, 0xbf, 0xdc, 0xf8, 0x44, 0x05, 0x08, 0x43,
0xdc, 0xf8, 0x44, 0x05, 0x88, 0x43, 0x17, 0xf4, 0x40, 0x7f, 0xcc, 0xf8, 0x44, 0x05, 0x19, 0xbf, 0xdc, 0xf8, 0x40, 0x05, 0x08, 0x43, 0xdc, 0xf8, 0x40, 0x05, 0x88, 0x43, 0xcc, 0xf8, 0x40, 0x05, 0x00, 0x2f, 0x19, 0xbf, 0xdc, 0xf8, 0x28, 0x05, 0x20, 0xea, 0x01, 0x01, 0xdc, 0xf8, 0x28, 0x05, 0x01, 0x43, 0xcc, 0xf8, 0x28, 0x15, 0xbd, 0xe8, 0xf0, 0x87, 0x00, 0x00, 0xff, 0x70, 0x00, 0xe0, 0x0f, 0x40, 0x00, 0x00, 0x05, 0x10, 0x0e, 0xb5, 0x15, 0x48, 0x00, 0xf0, 0x30, 0xf8, 0x14, 0x48, 0x0e, 0x21, 0x00, 0xf0, 0x72, 0xf8, 0x12, 0x48, 0x0e, 0x21, 0x00, 0x22, 0x00, 0xf0, 0x80, 0xf8, 0x11, 0x48, 0x00, 0x88, 0xad, 0xf8, 0x00, 0x00, 0x00, 0x20, 0x8d, 0xf8, 0x04, 0x00, 0x9d, 0xf8, 0x04, 0x00, 0x00, 0xeb, 0xd0, 0x71, 0x21, 0xf0, 0x01, 0x01, 0x40, 0x1a, 0x8d, 0xf8, 0x04, 0x00, 0x9d, 0xf8, 0x04, 0x00, 0x10, 0xf8, 0x0d, 0x20, 0x41, 0x1c, 0x05, 0x48, 0x8d, 0xf8, 0x04, 0x10, 0x0e, 0x21, 0x00, 0xf0, 0x65, 0xf8, 0x04, 0x48, 0x00, 0xf0, 0x65, 0xf8, 0xe7, 0xe7, 0x05, 0x08, 0x00, 0xf0, 0x00, 0x50, 0x02, 0x40, 0x06, 0x05, 0x02, 0x00, 0x40, 0x4b, 0x4c, 0x00, 0x0b, 0x4a, 0xc1, 0x08, 0xc0, 0xf3, 0x07, 0x23, 0x01, 0xf4,
0xff, 0x51, 0x00, 0xf0, 0xff, 0x00, 0xa1, 0xf5, 0x50, 0x31, 0xd2, 0x18, 0x21, 0xf0, 0x7e, 0x41, 0x12, 0x0f, 0x41, 0xea, 0x02, 0x71, 0x01, 0x22, 0x41, 0xea, 0x80, 0x01, 0x41, 0xf0, 0x00, 0x70, 0x02, 0x60, 0x70, 0x47, 0xc0, 0x46, 0x00, 0xe6, 0x0f, 0x40, 0x53, 0x08, 0x27, 0xbf, 0xd0, 0xf8, 0x00, 0x34, 0x0b, 0x43, 0xd0, 0xf8, 0x00, 0x34, 0x8b, 0x43, 0x92, 0x08, 0xc0, 0xf8, 0x00, 0x34, 0x27, 0xbf, 0xd0, 0xf8, 0x20, 0x24, 0x11, 0x43, 0xd0, 0xf8, 0x20, 0x24, 0x22, 0xea, 0x01, 0x01, 0xc0, 0xf8, 0x20, 0x14, 0x70, 0x47, 0x08, 0x48, 0x80, 0xf3, 0x08, 0x88, 0x08, 0x49, 0x08, 0x68, 0x40, 0xf4, 0x70, 0x00, 0x08, 0x60, 0x00, 0xbf, 0x00, 0xbf, 0x00, 0xf0, 0x23, 0xf8, 0x00, 0x20, 0xff, 0xf7, 0x8d, 0xff, 0x01, 0x20, 0x00, 0xf0, 0x1f, 0xf8, 0x00, 0x02, 0x00, 0x20, 0x88, 0xed, 0x00, 0xe0, 0x38, 0xb5, 0x01, 0x22, 0x0c, 0x46, 0x05, 0x46, 0x08, 0x23, 0xff, 0xf7, 0xc9, 0xfe, 0x01, 0x22, 0x21, 0x46, 0x28, 0x46, 0xff, 0xf7, 0xc8, 0xff, 0x38, 0xbd, 0xff, 0xf7, 0xdb, 0xbf, 0x70, 0x47, 0xfe, 0xe7, 0xfe, 0xe7, 0xfe, 0xe7, 0x40, 0xf8, 0x21, 0x20, 0x70, 0x47, 0x40, 0x1e, 0xfd, 0xd1, 0x70, 0x47, 0x01, 0x20, 0x70, 0x47,
0x00, 0xbf, 0xfe, 0xe7, 0x08, 0x00};




bool TimerOverFlowFlag = false;

void jump_to_app(uint32_t address) {
    // disable interrupts
    IntMasterDisable();
    // redirect the vector table
    HWREG(NVIC_VTABLE) = address;
    jump(address);
}


void check_update(uint32_t waitMelliSeconds){

    init_timer();
    init_uart();
    /*wait for some time for any thing from uart*/
    start_timer_ms(waitMelliSeconds);

    while(!TimerOverFlowFlag)
    {
        /*read data from Uart*/

        /* Check if data is available to read */
        if (UARTCharsAvail((uint32_t)UART0_BASE))
        {
            /* Read and process incoming data */
            uint32_t receivedChar = UARTCharGet((uint32_t)UART0_BASE);


            /* Check if the received character is the update command*/
            if((receivedChar-'0' == CMD_UPDATE))
            {
                /*Send ok and start update process*/
                UARTprint("ok\n");
                update();
                break;
            }
            else{
                UARTprint("press 5 to start flashing ?\n");
            }
        }
    }
    TimerOverFlowFlag =false;

}




void update(void){




    /*get current flag value if any*/
    uint32_t* flag_pointer =  (uint32_t*)FLAG_APP_START;
    uint32_t temp = flag_pointer[0] + 1;
    uint32_t address;
    /*make sure it doesn't exceed 1*/
    temp %= 2;
    /*depending of the flag value check which address & data we will write to*/
    if(temp == 0){

        address = APP_START_1;
    }else{
        address = APP_START_2;
    }

    /*init flash with the required size per block 1k*/
    uint16_t block =0,size=5000;
    for(block = 0 ; block < size/1000 ; block++)
    {
        FlashErase(address+block);
    }




    /*convert u8 to u32*/
    uint16_t dataCount =0;
        for(dataCount=0;dataCount<sizeof(dummy_image_0)/sizeof(dummy_image_0[0]);dataCount+=4)
        {
            // Use a pointer to interpret the 8-bit array as a 32-bit integer
            myData = *((uint32_t*)(dummy_image_0+dataCount));

            FlashProgram(&myData,address + dataCount,sizeof(myData));

        }

    /*write flag*/
    FlashErase(FLAG_APP_START);

    FlashProgram(&temp,FLAG_APP_START,sizeof(temp));

}
